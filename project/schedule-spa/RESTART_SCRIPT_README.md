# Скрипт для перезапуска проекта schedule-spa

## Описание
Этот скрипт (`restart_schedule_spa.sh`) предназначен для полного перезапуска проекта schedule-spa. Он автоматически останавливает текущий сервер, проверяет зависимости, запускает сервер заново и проверяет его работоспособность.

## Возможности
- ✅ Автоматическая остановка запущенного сервера
- ✅ Проверка и обновление зависимостей Python
- ✅ Архивирование старых логов
- ✅ Запуск сервера с автоматической перезагрузкой (`--reload`)
- ✅ Проверка доступности сервера после запуска
- ✅ Цветной вывод с подробным логированием
- ✅ Обработка ошибок и сигналов прерывания

## Использование

### Базовое использование
```bash
cd /var/www/schedule-spa
./restart_schedule_spa.sh
```

### Права доступа
Убедитесь, что скрипт имеет права на выполнение:
```bash
chmod +x restart_schedule_spa.sh
```

## Что делает скрипт

1. **Проверка окружения**
   - Переходит в директорию проекта `/var/www/schedule-spa`
   - Проверяет наличие основных файлов (`app/main.py`, `requirements.txt`)

2. **Остановка сервера**
   - Находит запущенные процессы uvicorn
   - Корректно останавливает сервер
   - При необходимости выполняет принудительную остановку

3. **Подготовка к запуску**
   - Архивирует старые логи
   - Обновляет зависимости Python (если есть `requirements.txt`)
   - Создает директорию для логов

4. **Запуск сервера**
   - Запускает uvicorn с параметрами:
     - `--host 0.0.0.0` (доступен извне)
     - `--port 8000` (стандартный порт)
     - `--reload` (автоматическая перезагрузка при изменениях)
   - Сохраняет PID процесса в `logs/server.pid`

5. **Проверка работоспособности**
   - Проверяет, что процесс запустился
   - Тестирует доступность сервера через HTTP-запрос
   - Выводит подробную информацию о статусе

## Выходные коды
- `0` - Успешный перезапуск
- `1` - Ошибка выполнения

## Логи
- Основные логи сервера: `logs/server.log`
- Архивные логи: `logs/server_YYYYMMDD_HHMMSS.log`
- PID файл: `logs/server.pid`

## Связанные скрипты
- `start_server.sh` - Запуск сервера
- `stop_server.sh` - Остановка сервера
- `status_server.sh` - Проверка статуса сервера

## Примеры использования

### Перезапуск после изменений в коде
```bash
./restart_schedule_spa.sh
```

### Перезапуск с просмотром логов
```bash
./restart_schedule_spa.sh && tail -f logs/server.log
```

### Проверка статуса после перезапуска
```bash
./restart_schedule_spa.sh && ./status_server.sh
```

## Устранение неполадок

### Сервер не запускается
1. Проверьте логи: `cat logs/server.log`
2. Убедитесь, что порт 8000 свободен: `netstat -tlnp | grep 8000`
3. Проверьте права доступа к файлам

### Ошибки зависимостей
1. Убедитесь, что установлен Python и pip
2. Проверьте файл `requirements.txt`
3. Рассмотрите использование виртуального окружения

### Проблемы с правами доступа
```bash
sudo chown -R $USER:$USER /var/www/schedule-spa
chmod +x restart_schedule_spa.sh
```

## Автор
AI Assistant - улучшенная версия оригинального скрипта restart_server.sh
