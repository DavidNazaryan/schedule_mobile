# üöÄ –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### üßπ **–û—á–∏—Å—Ç–∫–∞ –æ—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤:**
- ‚ùå –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- ‚ùå –£–¥–∞–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `testMode()` –∏ `testAdminMode()`
- ‚ùå –£–¥–∞–ª–µ–Ω—ã –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚ùå –£–±—Ä–∞–Ω—ã –≤—Å–µ fallback'–∏ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚ùå –û—á–∏—â–µ–Ω—ã localStorage –ø—Ä–æ–≤–µ—Ä–∫–∏

### üîê **–ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:**

#### 1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp**
```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
if (!window.Telegram?.WebApp) {
    console.error('‚ùå Telegram WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
    this.showError('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω–æ –≤ Telegram');
    return;
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp
webApp.ready();
webApp.expand();
```

#### 2. **–î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
```javascript
// –£—Ä–æ–≤–µ–Ω—å 1: initDataUnsafe (–ª–æ–∫–∞–ª—å–Ω–æ)
if (webApp.initDataUnsafe?.user) {
    await this.createUserFromTelegramData(telegramUser);
}

// –£—Ä–æ–≤–µ–Ω—å 2: initData (—á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä)
else if (webApp.initData) {
    await this.authenticateWithServer(webApp.initData);
}

// –û—à–∏–±–∫–∞, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
else {
    throw new Error('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã');
}
```

#### 3. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram –¥–∞–Ω–Ω—ã—Ö**
```javascript
const user = {
    id: telegramUser.id,
    first_name: telegramUser.first_name,
    last_name: telegramUser.last_name || '',
    username: telegramUser.username || '',
    photo_url: telegramUser.photo_url || '',
    language_code: telegramUser.language_code || 'ru',
    role: "student", // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—Å–µ –Ω–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ - —Å—Ç—É–¥–µ–Ω—Ç—ã
    group_id: this.getGroupIdFromUrl(),
    status: "active",
    created_at: new Date().toISOString(),
    last_seen: new Date().toISOString()
};
```

#### 4. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ**
```javascript
// –ü—ã—Ç–∞–µ–º—Å—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ API
const response = await fetch('/api/users', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(user)
});
```

## üéØ **–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã**

### **–°—Ü–µ–Ω–∞—Ä–∏–π 1: initDataUnsafe –¥–æ—Å—Ç—É–ø–µ–Ω**
1. ‚úÖ –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ `initDataUnsafe.user`
2. ‚úÖ –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ª–æ–∫–∞–ª—å–Ω–æ
3. ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, [–ò–º—è]!"

### **–°—Ü–µ–Ω–∞—Ä–∏–π 2: –¢–æ–ª—å–∫–æ initData –¥–æ—Å—Ç—É–ø–µ–Ω**
1. ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º `initData` –Ω–∞ —Å–µ—Ä–≤–µ—Ä `/api/auth/telegram`
2. ‚úÖ –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å –∏ —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. ‚úÖ –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–µ—Ä–≤–µ—Ä–∞
4. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, [–ò–º—è]!"

### **–°—Ü–µ–Ω–∞—Ä–∏–π 3: –û—à–∏–±–∫–∞**
1. ‚ùå –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Å–∏–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
2. ‚ùå "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω–æ –≤ Telegram"

## üìä **–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏**

### **–£—Å–ø–µ—à–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:**
```
üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AuthManager –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞...
‚úÖ Telegram WebApp API –Ω–∞–π–¥–µ–Ω
üìä WebApp –¥–∞–Ω–Ω—ã–µ: {initData: "–î–æ—Å—Ç—É–ø–µ–Ω", initDataUnsafe: "–î–æ—Å—Ç—É–ø–µ–Ω", version: "7.0"}
üîê –ù–∞—á–∏–Ω–∞–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...
‚úÖ –ù–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ initDataUnsafe
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {id: 123456789, first_name: "–ò–≤–∞–Ω", username: "ivan"}
üë§ –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –¥–∞–Ω–Ω—ã—Ö Telegram...
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω: {id: 123456789, first_name: "–ò–≤–∞–Ω", ...}
üìù –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ...
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```

### **–û—à–∏–±–∫–∞:**
```
üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AuthManager –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞...
‚ùå Telegram WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
üö® –û—à–∏–±–∫–∞: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω–æ –≤ Telegram
```

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

### **–í Telegram WebApp:**
1. ‚úÖ –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. ‚úÖ –î–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
3. ‚úÖ –î–æ–ª–∂–µ–Ω –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
4. ‚úÖ –í –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø—Ä–æ—Å –∫ `/api/users`

### **–í–Ω–µ Telegram:**
1. ‚ùå –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –∫—Ä–∞—Å–∏–≤—É—é –æ—à–∏–±–∫—É
2. ‚ùå –ù–µ –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. ‚ùå –ù–µ –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏

## üö® **–í–∞–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è**

### **–£–¥–∞–ª–µ–Ω–æ –∏–∑ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:**
- ‚ùå –¢–µ—Å—Ç–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
- ‚ùå –§—É–Ω–∫—Ü–∏–∏ `testMode()` –∏ `testAdminMode()`
- ‚ùå –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –≤—Ö–æ–¥–∞
- ‚ùå localStorage fallback'–∏
- ‚ùå –°–æ–∑–¥–∞–Ω–∏–µ "Telegram User" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### **–î–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram WebApp API
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp (`ready()`, `expand()`)
- ‚úÖ –ö—Ä–∞—Å–∏–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —ç–º–æ–¥–∑–∏

## üéâ **–†–µ–∑—É–ª—å—Ç–∞—Ç**

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –≥–æ—Ç–æ–≤–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
- ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ Telegram WebApp**
- ‚úÖ **–ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
- ‚úÖ **–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫—Ä–∞—Å–∏–≤—ã–µ –æ—à–∏–±–∫–∏**
- ‚úÖ **–ù–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ä–µ–∂–∏–º–æ–≤**
- ‚úÖ **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏**

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–µ–ª–∏–∑—É!** üöÄ

